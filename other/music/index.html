<html>

    <head>
        <title>
            Music Notes
        </title>

        <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.6.2.min.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
  
    </head>

<style>

body {
    font-weight: 2em;
}

div {
    padding: 1em;
}

.board {
    padding: 0em;
    width: 1000px;
    height: 588px;
    background-image: url('./caged-Cmaj-amin.png');
    background-repeat: repeat;
}

.board-top {
    height: 60px;
}

.board-main{
    height: 371px;
    width: 1074px;
    background-position: 0px -70px;
}

.board-bottom{
    height: 94px;
    background-position: 0px 0px;
    background-image: url('./scales-major.png');
    background-repeat: repeat;
    width: 915px;
}

.set-c {
    background-position: 0px -70px;
}

.set-g {
    background-position: -332px -70px;
}

.set-d {
    background-position: -664px -70px;
}

.set-a {
    background-position: -198px -70px;
}

.set-e {
    background-position: 269px -70px;
}

.set-b {
    background-position: -65px -70px;
}

.scale-c {
    background-position: 0px 0px;
}

.scale-g {
    background-position: 0px -114px;
}

.scale-d {
    background-position: 0px -228px;
}

.scale-a {
    background-position: 0px -380px;
}

.scale-e {
    background-position: 0px -494px;
}

.scale-b {
    background-position: 0px -608px;
}

.buttons {
    div {
        cursor: pointer;
        background: orange;
        display: inline-block;
        margin: .25em;
        width: 5em;
        height: 5em;
        max-width: 5em;
        max-height: 5em;
        border-radius: 10px;
        font-weight: bold;
        text-align: center;

    }

    div.disabled {
      cursor: default;
      background: #CCC;
    }

    div.empty {
      cursor: default;
      background: white;
        width: 5em;
    }
}

.no-flats {
    background-image: url('./caged-no-flats.png');
}

.pentatonic {
    background-image: url('./caged-pentatonic.png');
}

.triads {
    background-image: url('./triads.png');
}

.minor {
    background-image: url('./minor.png');
}

.hidden {
  display: none;
}

.minor.pentatonic {
    background-position-y: -498px;
}

.minor.triads {
    background-position-y: -911px;
}




</style>
    <body>


        <div>
            <img src="./NOTES-Cmaj.png" style="width: 946px" />
        </div>

        <div>
            <img src="./fretboard Natural.jpg" style="width: 1003px" />
        </div>

        <div class="buttons">
            <div onclick="board_toggle_class('no-flats')"> Hide Flats </div>
            <div onclick="board_toggle_class('pentatonic')"> Pentatonic </div>
            <div onclick="board_toggle_class('triads')"> Triads </div>
            <div onclick="board_toggle_class('minor')"> Minor </div>
        </div>

        <div>

            <div class="board board-top">
            </div>
            <div id="board" class="board board-main set-c">
            </div>
            <div id="board-bottom" class="board board-bottom hidden">
            </div>
            <div>
                <table border=0 style="font-family: monospace; font-size: 30px; width: 950px; font-weight: bold; text-align: center;">
                    <tr id="major_header"> <td>&nbsp;</td>
                         <th> 1 </th>
                         <th> - </th>
                         <th> 2 </th>
                         <th> - </th>
                         <th> 3 </th>
                         <th> 4 </th>
                         <th> - </th>
                         <th> 5 </th>
                         <th> - </th>
                         <th> 6 </th>
                         <th> - </th>
                         <th> 7 </th>
                         <th> 1 </th> </tr>
                    <tr id="minor_header" class="hidden"> <td>&nbsp;</td>
                         <th> 1 </th>
                         <th> - </th>
                         <th> 2 </th>
                         <th> 3 </th>
                         <th> - </th>
                         <th> 4 </th>
                         <th> - </th>
                         <th> 5 </th>
                         <th> 6 </th>
                         <th> - </th>
                         <th> 7 </th>
                         <th> - </th>
                         <th> 1 </th> </tr>
                    <tr> <td style="width: 180px;" id="sc-name">C Major</td>
                         <td id="sc-1" > </td>
                         <td id="sc-2" > </td>
                         <td id="sc-3" > </td>
                         <td id="sc-4" > </td>
                         <td id="sc-5" > </td>
                         <td id="sc-6" > </td>
                         <td id="sc-7" > </td>
                         <td id="sc-8" > </td>
                         <td id="sc-9" > </td>
                         <td id="sc-10"> </td>
                         <td id="sc-11"> </td>
                         <td id="sc-12"> </td>
                         <td id="sc-13"> </td> </tr>
                </table>
            </div>
        </div>

        <div class="buttons keys ">
            <div onclick="on_key_click('c', 'am')"  major="c" minor="am"> C/a </div>
            <div onclick="on_key_click('g', 'em')"  major="g" minor="em"> G/e </div>
            <div onclick="on_key_click('d', 'bm')"  major="d" minor="bm"> D/b </div>
            <div onclick="on_key_click('a', 'fsm')" major="a" minor="fsm"> A/f&sharp; </div>
            <div onclick="on_key_click('e', 'csm')" major="e" minor="csm"> E/c&sharp; </div>
            <div onclick="on_key_click('b', 'gsm')" major="b" minor="gsm"> B/g&sharp; </div>
        </div>
        <div class="buttons keys ">
          <div class="disabled"> F&natural;/d </div> <!-- natural used because of odd rendering -->
            <div class="disabled"> B&flat;/g </div>
            <div class="disabled"> E&flat;/c </div>
            <div class="disabled"> A&flat;/f </div>
            <div class="disabled"> D&flat;/b&flat; </div>
            <div class="disabled"> G&flat;/e&flat; <!--span>(F&sharp;/d&sharp;)</span--> </div>
        </div>

        <div>
            Drum Tracks from <a href="https://www.midnightdrummer.com/backing-drum-tracks/" target="_blank">midnightdrummer.com</a>
        </div>

        <div>
            <audio controls loop >
                  <source id="audio-player" src="./tracks/Basic-Shuffle-Groove-120-BPM.mp3" type="audio/mpeg" />
                  Your browser does not support the audio element.
            </audio>
        </div>

        <!--div class="buttons">
          <div id="audio" onclick="play_track();">PLAY</div>
        </div-->

    </body>

    <script type="text/javascript">

let keys = { };
keys.c   = 'C Major, C, D, E, F, G, A, B, C';
keys.am  = 'a minor, A, B, C, D, E, F, G, A';
keys.g   = 'G Major, G, A, B, C, D, E, F&sharp;, G';
keys.em  = 'e minor, E, F&sharp;, G, A, B, C, D, E';
keys.d   = 'D Major, D, E, F&sharp;, G, A, B, C&sharp;, D';
keys.bm  = 'b minor, B, C&sharp;, D, E, F&sharp;, G, A, B';
keys.a   = 'A Major, A, B, C&sharp;, D, E, F&sharp;, G&sharp;, A';
keys.fsm = 'f&sharp; minor, F&sharp;, G&sharp;, A, B, C&sharp;, D, E, F&sharp;';
keys.e   = 'E Major, E, F&sharp;, G&sharp;, A, B, C&sharp;, D&sharp;, E';
keys.csm = 'c&sharp; minor, C&sharp;, D&sharp;, E, F&sharp;, G&sharp;, A, B, C&sharp;';
keys.b   = 'B Major, B, C&sharp;, D&sharp;, E, F&sharp;, G&sharp;, A&sharp;, B';
keys.gsm = 'g&sharp; minor, G&sharp;, A&sharp;, B, C&sharp;, D&sharp;, E, F&sharp;, G&sharp;';

        function on_key_click(major_key, minor_key) {
            
          let _keys = ['c', 'g', 'd', 'a', 'e', 'b'];
          let $board = $('#board');
          let $scale = $('#board-bottom');

          _keys.forEach(key => {
              $board.removeClass('set-' + key);
              $scale.removeClass('scale-' + key);
          });

          for(let i = 1; i <= 13; ++i) {
              $('#sc-' + i ).html(''); 
          }

          $board.addClass('set-' + major_key);
          $scale.addClass('scale-' + major_key);

          let is_major = true;
          if($board.hasClass('minor')) {
            is_major = false;
            $('#major_header').addClass('hidden');
            $('#minor_header').removeClass('hidden');
          }
          else {
            $('#major_header').removeClass('hidden');
            $('#minor_header').addClass('hidden');
          }

          let _newkey = is_major ? major_key : minor_key;
          if(keys[_newkey]) {
            let k = keys[ _newkey ].split(', ');

            $('#sc-name' ).html(k[0]); 

            if(is_major) {
              $('#sc-1' ).html(k[1]); 
              $('#sc-3' ).html(k[2]); 
              $('#sc-5' ).html(k[3]); 
              $('#sc-6' ).html(k[4]); 
              $('#sc-8' ).html(k[5]); 
              $('#sc-10').html(k[6]); 
              $('#sc-12').html(k[7]); 
              $('#sc-13').html(k[8]); 
            }
            else {
              $('#sc-1' ).html(k[1]); 
              $('#sc-3' ).html(k[2]); 
              $('#sc-4' ).html(k[3]); 
              $('#sc-6' ).html(k[4]); 
              $('#sc-8' ).html(k[5]); 
              $('#sc-9' ).html(k[6]); 
              $('#sc-11').html(k[7]); 
              $('#sc-13').html(k[8]); 
            }
          }
        }

        function board_toggle_class(css_class) {
            let $board = $('#board');

            if($board.hasClass(css_class)) {
                $board.removeClass(css_class);
                if(css_class === 'minor') {
                  console.log('minor toggle off');
                }
            }
            else {
                $board.addClass(css_class);
                if(css_class === 'minor') {
                  console.log('minor toggle on');
                }
            }

        }

        function on_load() {

          let params = document.location.href.split('?');

          let args = null;

          if(params.length > 1) {

            args = {};

            let paramlist = params[1].split('&');


            for(let i = 0; i < paramlist.length; ++i) {
              let current = paramlist[i];
              let _arg = current.split('=');
              let arg = _arg[0];
              let val = _arg[1];

              args[arg] = val;
            }
          }
          console.log(args);


          if(args) {

            if(args['minor']) {
              board_toggle_class('minor');
            }

            if(args['no-flats']) {
              board_toggle_class('no-flats');
            }

            // these are exclusive so if more than one are in the url,
            // then the first one found will be used and the others are ignored.
            if(args['triads']) {
              board_toggle_class('triads');
            }
            else if(args['pentatonic']) {
              board_toggle_class('pentatonic');
            }


            let accepted_major  = '_c_g_d_a_e_b_';
            let accepted_minor = '_am_em_bm_fsm_csm_gsm_';

            if(args.key) {
              if(accepted_major.indexOf('_' + args.key + '_') > 0) {
                on_key_click(args.key, 'am');
              }
              else if(accepted_minor.indexOf('_' + args.key + '_') > 0) {
                on_key_click('c', args.key);
              }
            }
            else {
              on_key_click('c', 'am');
            }

          }

        }

        let sound = null;
        function play_track() {
            if(sound == null) {
                sound = new Howl({
                  src: ['./tracks/Basic-Shuffle-Groove-120-BPM.mp3'],
                  loop: true
                });
            }

          let $audio = $('#audio');
          if($audio.html().trim() == 'PLAY') {
            sound.play();
            $audio.html('STOP');
          }
          else if($audio.html().trim() == 'STOP') {
            sound.stop();
            $audio.html('PLAY');
          }
          
        }

        $(document).ready(on_load);

    </script>
</html>
