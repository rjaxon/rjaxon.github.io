<html>

    <head>
        <title>
            Music Notes
        </title>

        <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.6.2.min.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
  
    </head>

<style>

body {
    font-weight: 2em;
}

div {
    padding: 1em;
}

#notes {

/* relative necessary because child .note
   use absolute positioning */
    position: relative;
    padding: 0em;
    width: 946px;
    height: 478px;

    background-image: url('./NOTES-Cmaj-2.png');
    background-repeat: no-repeat;
}

.note {
    padding: 0em;
    width: 40px;
    height: 60px;
    position: absolute;
    background-image: url('./NOTES-Cmaj-2.png');
    background-repeat: no-repeat;
}

.note-none {
    background-position: -152px -109px;
}

.note-e {
    background-position: -10px -40px;
}
.note-f {
    background-position: -79px -40px;
}

.flat {
    padding: 0em;
    width: 15px;
    height: 20px;
    position: relative;
    background-image: url('./NOTES-Cmaj-2.png');
    background-repeat: no-repeat;
    background-position: -27px -490px;
}

.sharp {
    padding: 0em;
    width: 15px;
    height: 20px;
    position: relative;
    background-image: url('./NOTES-Cmaj-2.png');
    background-repeat: no-repeat;
    background-position: -5px -490px;
}

.natural {
    padding: 0em;
    width: 15px;
    height: 20px;
    position: relative;
    background-image: url('./NOTES-Cmaj-2.png');
    background-repeat: no-repeat;
    background-position: -47px -490px;
}


.board {
    padding: 0em;
    width: 1000px;
    height: 588px;
    background-image: url('./caged-Cmaj-amin.png');
    background-repeat: repeat;
}

.board-top {
    height: 60px;
}

.board-main{
    height: 371px;
    width: 1074px;
    background-position: 0px -70px;
}

.board-bottom{
    height: 94px;
    background-position: 0px 0px;
    background-image: url('./scales-major.png');
    background-repeat: repeat;
    width: 915px;
}

.set-c {
    background-position: 0px -70px;
}

.set-g {
    background-position: -332px -70px;
}

.set-d {
    background-position: -664px -70px;
}

.set-a {
    background-position: -198px -70px;
}

.set-e {
    background-position: 269px -70px;
}

.set-b {
    background-position: -65px -70px;
}

.set-f {
    background-position: -465px -70px;
}

.set-bf {
    background-position: -133px -70px;
}

.set-ef {
    background-position: 202px -70px;
}


.set-af {
    background-position: -265px -70px;
}


.set-df {
    background-position: -733px -70px;
}

.set-gf {
    background-position: -397px -70px;
}

.buttons {
    div {
        cursor: pointer;
        background: orange;
        display: inline-block;
        margin: .25em;
        width: 5em;
        height: 5em;
        max-width: 5em;
        max-height: 5em;
        border-radius: 10px;
        font-weight: bold;
        text-align: center;

    }

    div.disabled {
      cursor: default;
      background: #CCC;
    }

    div.empty {
      cursor: default;
      background: white;
        width: 5em;
    }
}

.no-flats {
    background-image: url('./caged-no-flats.png');
}

.pentatonic {
    background-image: url('./caged-pentatonic.png');
}

.triads {
    background-image: url('./triads.png');
}

.minor {
    background-image: url('./minor.png');
}

.hidden {
  display: none;
}

.minor.pentatonic {
    background-position-y: -498px;
}

.minor.triads {
    background-position-y: -911px;
}

.on {
    background: #f4e519 !important;
}

.selected {
    background: #f4e519 !important;
}

.selected-as-minor {
    background: #75cf3f !important;
}

.red {
    color: red;
}

.lt-gray {
    color: #ccc;
}


</style>
    <body>

        <div>
            <div id="notes">
                <div class="note note-none hidden" style="left: 108px; top: 64px;" ></div>
                <div class="note note-f" style="left: 152px; top: 40px;" ></div>
                <div class="sharp" style="left: 144px; top: 46px;" ></div>
            </div>
        </div>

        <div>
            <img src="./fretboard Natural.jpg" style="width: 1003px" />
        </div>



        <div class="buttons">
            <div id="btn-no-flats" onclick="board_toggle_class('no-flats', this)"> Hide Flats </div>
            <div id="btn-pentatonic" onclick="board_toggle_class('pentatonic', this)"> Pentatonic </div>
            <div id="btn-triads" onclick="board_toggle_class('triads', this)"> Triads </div>
            <div id="btn-minor" onclick="board_toggle_class('minor', this)"> Minor </div>
        </div>

        <div>

            <div class="board board-top">
            </div>
            <div id="board" class="board board-main set-c">
            </div>
            <div id="board-bottom" class="board board-bottom hidden">
            </div>
            <div>
                <table border=0 style="font-family: monospace; font-size: 30px; width: 950px; font-weight: bold; text-align: center;">
                    <tr id="major_header"> <td>&nbsp;</td>
                         <th> 1 </th>
                         <th> - </th>
                         <th> 2 </th>
                         <th> - </th>
                         <th> 3 </th>
                         <th> 4 </th>
                         <th> - </th>
                         <th> 5 </th>
                         <th> - </th>
                         <th> 6 </th>
                         <th> - </th>
                         <th> 7 </th>
                         <th> 1 </th> </tr>
                    <tr id="minor_header" class="hidden"> <td>&nbsp;</td>
                         <th> 1 </th>
                         <th> - </th>
                         <th> 2 </th>
                         <th> 3 </th>
                         <th> - </th>
                         <th> 4 </th>
                         <th> - </th>
                         <th> 5 </th>
                         <th> 6 </th>
                         <th> - </th>
                         <th> 7 </th>
                         <th> - </th>
                         <th> 1 </th> </tr>
                    <tr> <td style="width: 180px;" id="sc-name">C Major</td>
                         <td id="sc-1" class="red" > </td>
                         <td id="sc-2" > </td>
                         <td id="sc-3" > </td>
                         <td id="sc-4" class="red" > </td>
                         <td id="sc-5" class="red" > </td>
                         <td id="sc-6" > </td>
                         <td id="sc-7" > </td>
                         <td id="sc-8" class="red" > </td>
                         <td id="sc-9" > </td>
                         <td id="sc-10"> </td>
                         <td id="sc-11"> </td>
                         <td id="sc-12"> </td>
                         <td id="sc-13"> </td> </tr>
                </table>
            </div>
        </div>

        <div class="buttons keys ">
            <div id="btn-c" onclick="on_key_click('c', 'am', this)"  major="c" minor="am" > C / a </div>
            <div id="btn-g" onclick="on_key_click('g', 'em', this)"  major="g" minor="em" > G / e </div>
            <div id="btn-d" onclick="on_key_click('d', 'bm', this)"  major="d" minor="bm" > D / b </div>
            <div id="btn-a" onclick="on_key_click('a', 'fsm', this)" major="a" minor="fsm"> A / f&sharp; </div>
            <div id="btn-e" onclick="on_key_click('e', 'csm', this)" major="e" minor="csm"> E / c&sharp; </div>
            <div id="btn-b" onclick="on_key_click('b', 'gsm', this)" major="b" minor="gsm"> B / g&sharp; </div>
        </div>
        <div class="buttons keys ">
            <div id="btn-f"  onclick="on_key_click('f', 'dm', this)"  major="f" minor="dm" > F&natural; / d </div><!-- natural used because of odd rendering -->
            <div id="btn-bf" onclick="on_key_click('bf', 'gm', this)"  major="bf" minor="gm" > B&flat; / g </div>
            <div id="btn-ef" onclick="on_key_click('ef', 'cm', this)"  major="ef" minor="cm" > E&flat; / c </div>
            <div id="btn-af" onclick="on_key_click('af', 'fm', this)"   major="af" minor="fm" > A&flat; / f </div>
            <div id="btn-df" onclick="on_key_click('df', 'bfm', this)"  major="df" minor="bfm" > D&flat; / b&flat; </div>
            <div id="btn-gf" onclick="on_key_click('gf', 'efm', this)"  major="gf" minor="efm" > G&flat; / e&flat; </div>
        </div>

        <div>
            Drum Tracks from <a href="https://www.midnightdrummer.com/backing-drum-tracks/" target="_blank">midnightdrummer.com</a>
        </div>

        <div>
            <audio controls loop >
                  <source id="audio-player" src="./tracks/Basic-Shuffle-Groove-120-BPM.mp3" type="audio/mpeg" />
                  Your browser does not support the audio element.
            </audio>
        </div>

        <!--div class="buttons">
          <div id="audio" onclick="play_track();">PLAY</div>
        </div-->

    </body>

    <script type="text/javascript">

let keys = { };
keys.c   = 'C Major, C, D, E, F, G, A, B, C';
keys.am  = 'a minor, A, B, C, D, E, F, G, A';
keys.g   = 'G Major, G, A, B, C, D, E, F&sharp;, G';
keys.em  = 'e minor, E, F&sharp;, G, A, B, C, D, E';
keys.d   = 'D Major, D, E, F&sharp;, G, A, B, C&sharp;, D';
keys.bm  = 'b minor, B, C&sharp;, D, E, F&sharp;, G, A, B';
keys.a   = 'A Major, A, B, C&sharp;, D, E, F&sharp;, G&sharp;, A';
keys.fsm = 'f&sharp; minor, F&sharp;, G&sharp;, A, B, C&sharp;, D, E, F&sharp;';
keys.e   = 'E Major, E, F&sharp;, G&sharp;, A, B, C&sharp;, D&sharp;, E';
keys.csm = 'c&sharp; minor, C&sharp;, D&sharp;, E, F&sharp;, G&sharp;, A, B, C&sharp;';
keys.b   = 'B Major, B, C&sharp;, D&sharp;, E, F&sharp;, G&sharp;, A&sharp;, B';
keys.gsm = 'g&sharp; minor, G&sharp;, A&sharp;, B, C&sharp;, D&sharp;, E, F&sharp;, G&sharp;';
keys.f   = 'F Major, F, G, A, B&flat;, C, D, E, F';
keys.dm  = 'd minor, D, E, F, G, A, B&flat;, C, D';
keys.bf  = 'B&flat; Major, B&flat;, C, D, E&flat;, F, G, A, B&flat;';
keys.gm  = 'g minor, G, A, B&flat;, C, D, E&flat;, F, G';
keys.ef  = 'E&flat; Major, E&flat;, F, G, A&flat;, B&flat;, C, D, E&flat;';
keys.cm  = 'c minor, C, D, E&flat;, F, G, A&flat;, B&flat;, C';

keys.af  = 'A&flat; Major, A&flat;, B&flat;, C, D&flat;, E&flat;, F, G, A&flat;';
keys.fm  = 'f minor, F, G, A&flat;, B&flat;, C, D&flat;, E&flat;, F';

keys.df  = 'D&flat; Major, D&flat;, E&flat;, F, G&flat;, A&flat;, B&flat;, C, D&flat;';
keys.bfm = 'b&flat; minor, B&flat;, C, D&flat;, E&flat;, F, G&flat;, A&flat;, B&flat;';

keys.gf  = 'G&flat; Major, G&flat;, A&flat;, B&flat;, C&flat;, D&flat;, E&flat;, F, G&flat;';
keys.efm = 'e&flat; minor, E&flat;, F, G&flat;, A&flat;, B&flat;, C&flat;, D&flat;, E&flat;';

        function on_key_click(major_key, minor_key, sender) {
            
          let _keys = ['c', 'g', 'd', 'a', 'e', 'b', 'f',
                       'bf', 'ef', 'af', 'df', 'gf'];
          let $board = $('#board');
          let $scale = $('#board-bottom');
          $s = $(sender);


          _keys.forEach(key => {
              $board.removeClass('set-' + key);
              $scale.removeClass('scale-' + key);
          });

          for(let i = 1; i <= 13; ++i) {
              let $c = $('#sc-' + i );
              $c.html('');
              $c.removeClass('lt-gray');
              
          }


          let $pentatonic = $('#btn-pentatonic');
          let $triads = $('#btn-triads');
          let $minor = $('#btn-minor');
          let $selected = $('.selected');
          let was_minor = $selected.hasClass('selected-as-minor');
          $selected.removeClass('selected-as-minor');
          $selected.removeClass('selected');
          $s.addClass('selected');

          if($minor.hasClass('on')) {
            $s.addClass('selected-as-minor');
          }

          // if already selected, should it toggle to minor?
          
          // if($selected.length > 0 && $s.length > 0) {
          //   if($selected[0].id == $s[0].id) {
          //     if(!was_minor) {
          //       $s.addClass('selected-as-minor');
          //       // set up as minor
          //     }
          //     else {
          //       // set up as major
          //     }
          //   }
          // }


          $board.addClass('set-' + major_key);
          $scale.addClass('scale-' + major_key);

          let is_major = true;
          // if($board.hasClass('minor')) {
          if($minor.hasClass('on')) {
            is_major = false;
            $('#major_header').addClass('hidden');
            $('#minor_header').removeClass('hidden');
          }
          else {
            $('#major_header').removeClass('hidden');
            $('#minor_header').addClass('hidden');
          }

          let _newkey = is_major ? major_key : minor_key;
          if(keys[_newkey]) {
            let k = keys[ _newkey ].split(', ');

            $('#sc-name' ).html(k[0]); 

            let is_5 = $pentatonic.hasClass('on');
            if(is_major) {
              $('#sc-1' ).html(k[1]); 
              $('#sc-3' ).html(k[2]); 
              $('#sc-5' ).html(k[3]); 
              $('#sc-6' ).html(k[4]); 
              $('#sc-8' ).html(k[5]); 
              $('#sc-10').html(k[6]); 
              $('#sc-12').html(k[7]); 
              $('#sc-13').html(k[8]); 

              if(is_5) {
                $('#sc-6' ).addClass('lt-gray');
                $('#sc-12' ).addClass('lt-gray');
              }
            }
            else {
              $('#sc-1' ).html(k[1]); 
              $('#sc-3' ).html(k[2]); 
              $('#sc-4' ).html(k[3]); 
              $('#sc-6' ).html(k[4]); 
              $('#sc-8' ).html(k[5]); 
              $('#sc-9' ).html(k[6]); 
              $('#sc-11').html(k[7]); 
              $('#sc-13').html(k[8]); 
              if(is_5) {
                $('#sc-3' ).addClass('lt-gray');
                $('#sc-9' ).addClass('lt-gray');
              }
            }
          }


        }

        function board_toggle_class(css_class, sender) {
            let $board = $('#board');

            if(sender) {
                let $s = $(sender);
                if($s.hasClass('on') ) {
                    $s.removeClass('on');
                }
                else {
                    $s.addClass('on');
                }
            }

            if($board.hasClass(css_class)) {
                $board.removeClass(css_class);
                if(css_class === 'minor') {
                  console.log('minor toggle off');

                  // update buttons and scale
                }
            }
            else {
                $board.addClass(css_class);
                if(css_class === 'minor') {
                  console.log('minor toggle on');

                  // update buttons and scale
                }
            }

        }

        function on_load() {

          let params = document.location.href.split('?');

          let args = null;

          if(params.length > 1) {

            args = {};

            let paramlist = params[1].split('&');


            for(let i = 0; i < paramlist.length; ++i) {
              let current = paramlist[i];
              let _arg = current.split('=');
              let arg = _arg[0];
              let val = _arg[1];

              args[arg] = val;
            }
          }
          console.log(args);


          if(args) {

            if(args['minor']) {
              let $btn = $('#btn-minor');
              $btn.addClass('on');
              board_toggle_class('minor');
            }

            if(args['no-flats']) {
              let $btn = $('#btn-no-flats');
              $btn.addClass('on');
              board_toggle_class('no-flats');
            }

            // these are exclusive so if more than one are in the url,
            // then the first one found will be used and the others are ignored.
            if(args['triads']) {
              let $btn = $('#btn-triads');
              $btn.addClass('on');
              board_toggle_class('triads');
            }
            else if(args['pentatonic']) {
              let $btn = $('#btn-pentatonic');
              $btn.addClass('on');
              board_toggle_class('pentatonic');
            }


            let accepted_major  = '_c_g_d_a_e_b_f_bf_ef_af_df_gf_';
            let accepted_minor = '_am_em_bm_fsm_csm_gsm_dm_gm_cm_fm_bfm_efm_';


            if(args.key) {
              if(accepted_major.indexOf('_' + args.key + '_') > 0) {
                $button = $('[major="' + args.key + '"]');
                // on_key_click(args.key, 'am');
                on_key_click($button.attr('major'), $button.attr('minor'), $button[0]);
              }
              else if(accepted_minor.indexOf('_' + args.key + '_') > 0) {
                $button = $('[minor="' + args.key + '"]');
                // on_key_click('c', args.key);
                on_key_click($button.attr('major'), $button.attr('minor'), $button[0]);
              }
            }
            else {
              on_key_click('c', 'am');
            }

          }

        }

        let sound = null;
        function play_track() {
            if(sound == null) {
                sound = new Howl({
                  src: ['./tracks/Basic-Shuffle-Groove-120-BPM.mp3'],
                  loop: true
                });
            }

          let $audio = $('#audio');
          if($audio.html().trim() == 'PLAY') {
            sound.play();
            $audio.html('STOP');
          }
          else if($audio.html().trim() == 'STOP') {
            sound.stop();
            $audio.html('PLAY');
          }
          
        }

        $(document).ready(on_load);

let note_data = {E: {}, A: {}, G: {}, B: {}, e: {}};

note_data.e = [12];
note_data.e[0] = { };
note_data.e[1] = { };

    </script>
</html>
