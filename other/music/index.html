<html>

    <head>
        <title>
            Music Notes
        </title>

        <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.6.2.min.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
  
    </head>

<style>

body {
    font-weight: 2em;
}

div {
    padding: 1em;
}

#notes {

/* relative necessary because child .note
   use absolute positioning */
    position: relative;
    padding: 0em;
    width: 946px;
    height: 478px;

    background-image: url('./NOTES-Cmaj-2-clear.png');
    background-repeat: no-repeat;
}

.note {
    padding: 0em;
    width: 40px;
    height: 60px;
    position: absolute;
    background-image: url('./NOTES-Cmaj-2.png');
    background-repeat: no-repeat;
}

.note-none {
    background-position: -152px -109px;
}

.flat {
    padding: 0em;
    width: 15px;
    height: 20px;
    position: absolute;
    background-image: url('./NOTES-Cmaj-2.png');
    background-repeat: no-repeat;
    background-position: -27px -490px;
}

.sharp {
    padding: 0em;
    width: 15px;
    height: 20px;
    position: absolute;
    background-image: url('./NOTES-Cmaj-2.png');
    background-repeat: no-repeat;
    background-position: -5px -490px;
}

.natural {
    padding: 0em;
    width: 15px;
    height: 20px;
    position: relative;
    background-image: url('./NOTES-Cmaj-2.png');
    background-repeat: no-repeat;
    background-position: -47px -490px;
}


.board {
    padding: 0em;
    width: 1000px;
    height: 588px;
    background-image: url('./caged-Cmaj-amin.png');
    background-repeat: repeat;
}

.board-top {
    height: 60px;
}

.board-main{
    height: 371px;
    width: 1074px;
    background-position: 0px -70px;
}

.board-bottom{
    height: 94px;
    background-position: 0px 0px;
    background-image: url('./scales-major.png');
    background-repeat: repeat;
    width: 915px;
}

.set-c {
    background-position: 0px -70px;
}

.set-g {
    background-position: -332px -70px;
}

.set-d {
    background-position: -664px -70px;
}

.set-a {
    background-position: -198px -70px;
}

.set-e {
    background-position: 269px -70px;
}

.set-b {
    background-position: -65px -70px;
}

.set-f {
    background-position: -465px -70px;
}

.set-bf {
    background-position: -133px -70px;
}

.set-ef {
    background-position: 202px -70px;
}


.set-af {
    background-position: -265px -70px;
}


.set-df {
    background-position: -733px -70px;
}

.set-gf {
    background-position: -397px -70px;
}

.buttons {
    div {
        cursor: pointer;
        background: orange;
        display: inline-block;
        margin: .25em;
        width: 5em;
        height: 5em;
        max-width: 5em;
        max-height: 5em;
        border-radius: 10px;
        font-weight: bold;
        text-align: center;

    }

    div.disabled {
      cursor: default;
      background: #CCC;
    }

    div.empty {
      cursor: default;
      background: white;
        width: 5em;
    }
}

.no-flats {
    background-image: url('./caged-no-flats.png');
}

.pentatonic {
    background-image: url('./caged-pentatonic.png');
}

.triads {
    background-image: url('./triads.png');
}

.minor {
    background-image: url('./minor.png');
}

.hidden {
  display: none;
}

.minor.pentatonic {
    background-position-y: -498px;
}

.minor.triads {
    background-position-y: -911px;
}

.on {
    background: #f4e519 !important;
}

.selected {
    background: #f4e519 !important;
}

.selected-as-minor {
    background: #75cf3f !important;
}

.red {
    color: red;
}

.penta-omit {
    color: #ccc;
}


.test-fretboard {
    position: relative;
    padding: 0px;
    width: 1062px;
    height: 371px;
    background-image: url(./fretboard-empty.png);
    background-position: 0px -75px;
}

.test-fretboard-top {
  position: relative;
  width: 1062px;
  height: 30px;
  padding: 0px;
}

.test-note {
  position: absolute;
  width: 55px;

}

.test-circle {
      display: inline;
    width: 30px;
    height: 30px;
    position: absolute;
    background: white;
    padding: 0px;
    border: 1px solid white;
    border-radius: 15px;
}

.test-container {
  padding: 0px;
  position: absolute;
  width: 55px;
  height: 55px;

  div.test-circle {
    left: 10px;
    top: 9px;
  }

  img.test-note {
    left: 0px;
    top: 0px;
  }

  span {
    svg {
      width: 55px;
    }
  }
}

.test-container.minor {
  width: 50px;
  height: 50px;

  span {
    svg {
      width: 50px;
    }
  }
}


</style>
    <body>

        <!--div>
            <div id="notes">
                <div class="note note-none hidden" style="left: 108px; top: 64px;" ></div>
            </div>
        </div-->
        <iframe id="notes_frame" style=" border: 0px; width: 980px; height: 450px; position: relative; left: 0px;"
            src="./fretboard/index.html" title="notes"></iframe>

        <div>
            <img src="./fretboard Natural.jpg" style="width: 1003px" />
        </div>



        <div class="buttons">
            <div id="btn-no-flats" onclick="board_toggle_class('no-flats', this)"> Hide Flats </div>
            <div id="btn-pentatonic" onclick="board_toggle_class('pentatonic', this)"> Pentatonic </div>
            <div id="btn-triads" onclick="board_toggle_class('triads', this)"> Triads </div>
            <div id="btn-minor" onclick="board_toggle_class('minor', this)"> Minor </div>
        </div>

        <div>

            <div class="board board-top">
            </div>
            <div id="board" class="board board-main set-c">
            </div>
            <div id="board-bottom" class="board board-bottom hidden">
            </div>


            <iframe id="pattern_frame" style=" border: 0px; width: 1083px; height: 278px; position: relative; left: 0px;"
            src="./fretboard/index.html?key=C&pattern" title="notes"></iframe>

            <!-- fret formula X = (fret * 66) + 9 -->
            <div class="hidden test-fretboard-top">
              <img src="./svg/dot-single.svg" style="width: 50px; position: absolute; top: -10px; left: 210px;" />
              <img src="./svg/dot-single.svg" style="width: 50px; position: absolute; top: -10px; left: 342px;" />
              <img src="./svg/dot-single.svg" style="width: 50px; position: absolute; top: -10px; left: 474px;" />
              <img src="./svg/dot-single.svg" style="width: 50px; position: absolute; top: -10px; left: 606px;" />
              <span style="width: 50px; position: absolute; top: -10px; left: 804px;" >
                <img src="./svg/dot-single.svg" style="width: 50px; position: absolute; top: -7px; left: 0px;" />
                <img src="./svg/dot-single.svg" style="width: 50px; position: absolute; top:  7px; left: 0px;" />
              </span>
            </div>


            <div class="test-fretboard hidden"> </div>
  
            <div>
                <table border=0 style="font-family: monospace; font-size: 30px; width: 950px; font-weight: bold; text-align: center;">
                    <tr id="major_header"> <td>&nbsp;</td>
                         <th> 1 </th>
                         <th> - </th>
                         <th> 2 </th>
                         <th> - </th>
                         <th> 3 </th>
                         <th> 4 </th>
                         <th> - </th>
                         <th> 5 </th>
                         <th> - </th>
                         <th> 6 </th>
                         <th> - </th>
                         <th> 7 </th>
                         <th> 1 </th> </tr>
                    <tr id="minor_header" class="hidden"> <td>&nbsp;</td>
                         <th> 1 </th>
                         <th> - </th>
                         <th> 2 </th>
                         <th> 3 </th>
                         <th> - </th>
                         <th> 4 </th>
                         <th> - </th>
                         <th> 5 </th>
                         <th> 6 </th>
                         <th> - </th>
                         <th> 7 </th>
                         <th> - </th>
                         <th> 1 </th> </tr>
                    <tr> <td style="width: 180px;" id="sc-name">C Major</td>
                         <td id="sc-1" class="red" > </td>
                         <td id="sc-2" > </td>
                         <td id="sc-3" > </td>
                         <td id="sc-4" class="red" > </td>
                         <td id="sc-5" class="red" > </td>
                         <td id="sc-6" > </td>
                         <td id="sc-7" > </td>
                         <td id="sc-8" class="red" > </td>
                         <td id="sc-9" > </td>
                         <td id="sc-10"> </td>
                         <td id="sc-11"> </td>
                         <td id="sc-12"> </td>
                         <td id="sc-13"> </td> </tr>
                </table>
            </div>
        </div>

        <div class="buttons keys ">
            <div id="btn-c" onclick="on_key_click('c', 'am', this)"  major="c" minor="am" > C / a </div>
            <div id="btn-g" onclick="on_key_click('g', 'em', this)"  major="g" minor="em" > G / e </div>
            <div id="btn-d" onclick="on_key_click('d', 'bm', this)"  major="d" minor="bm" > D / b </div>
            <div id="btn-a" onclick="on_key_click('a', 'fsm', this)" major="a" minor="fsm"> A / f&sharp; </div>
            <div id="btn-e" onclick="on_key_click('e', 'csm', this)" major="e" minor="csm"> E / c&sharp; </div>
            <div id="btn-b" onclick="on_key_click('b', 'gsm', this)" major="b" minor="gsm"> B / g&sharp; </div>
        </div>
        <div class="buttons keys ">
            <div id="btn-f"  onclick="on_key_click('f', 'dm', this)"  major="f" minor="dm" > F&natural; / d </div><!-- natural used because of odd rendering -->
            <div id="btn-bf" onclick="on_key_click('bf', 'gm', this)"  major="bf" minor="gm" > B&flat; / g </div>
            <div id="btn-ef" onclick="on_key_click('ef', 'cm', this)"  major="ef" minor="cm" > E&flat; / c </div>
            <div id="btn-af" onclick="on_key_click('af', 'fm', this)"   major="af" minor="fm" > A&flat; / f </div>
            <div id="btn-df" onclick="on_key_click('df', 'bfm', this)"  major="df" minor="bfm" > D&flat; / b&flat; </div>
            <div id="btn-gf" onclick="on_key_click('gf', 'efm', this)"  major="gf" minor="efm" > G&flat; / e&flat; </div>
        </div>

        <div>
            Drum Tracks from <a href="https://www.midnightdrummer.com/backing-drum-tracks/" target="_blank">midnightdrummer.com</a>
        </div>

        <div>
            <audio controls loop >
                  <source id="audio-player" src="./tracks/Basic-Shuffle-Groove-120-BPM.mp3" type="audio/mpeg" />
                  Your browser does not support the audio element.
            </audio>
        </div>

        <!--div class="buttons">
          <div id="audio" onclick="play_track();">PLAY</div>
        </div-->



    </body>

    <script type="text/javascript">

let svg_data = {};
svg_data.number1 = `
<svg fill="#FF0000" width="55px" height="55px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">
<path d="M16 3c-7.18 0-13 5.82-13 13s5.82 13 13 13 13-5.82 13-13-5.82-13-13-13z
M17.757 22.536h-2.469v-9.305c-0.901 0.841-1.964 1.463-3.188 1.867
v-2.234c0.644-0.211 1.344-0.612 2.099-1.202s1.273-1.278 1.555-2.064h2.003v12.938z"></path>
</svg> `;

svg_data.number6 = `
<svg fill="#004d00" width="55px" height="55px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">
<path d="M16.062 16.037c-0.476 0-0.877 0.186-1.205 0.558-0.329 0.372-0.493 0.921-0.493 
1.647 0 0.803 0.185 1.422 0.555 1.858 0.369 0.437 0.791 0.655 1.267 0.655 0.457 0 
0.839-0.18 1.144-0.537s0.457-0.942 0.457-1.757c0-0.838-0.164-1.451-0.492-1.841s-0.74-0.583-1.233-0.583z
M16 3c-7.18 0-13 5.82-13 13s5.82 13 13 13 13-5.82 13-13-5.82-13-13-13z
M19.047 21.607c-0.773 0.797-1.768 1.194-2.98 1.194-1.302 0-2.372-0.505-3.21-1.516s-1.258-2.667-1.258-4.97c0-2.361 
0.438-4.063 1.312-5.106s2.008-1.564 3.404-1.564c0.979 0 1.79 0.275 2.432 0.825 0.643 
0.551 1.052 1.349 1.228 2.396l-2.391 0.263c-0.059-0.49-0.212-0.853-0.458-1.086-0.247-0.234-0.567-0.351-0.961-0.351-0.523 
0-0.966 0.233-1.327 0.701s-0.589 1.44-0.683 2.92c0.615-0.726 1.381-1.089 2.297-1.089 1.032 0 1.916 0.392 2.652 
1.176s1.104 1.797 1.104 3.038c0 1.318-0.387 2.374-1.161 3.169z"></path>
</svg>
`
  function test_clear() {
    $('.test-fretboard').empty();
  }

  function test_load(starting_fret) {

    let s = starting_fret || 0;

    test_clear();

    test_add( (s + 0) % 12, 0, 3);
    test_add( (s + 1) % 12, 0, 4);
    test_add( (s + 3) % 12, 0, 5);
    test_add( (s + 5) % 12, 0, 6);
    test_add( (s + 7) % 12, 0, 7);
    test_add( (s + 8) % 12, 0, 1);
    test_add( (s +10) % 12, 0, 2);

    test_add( (s + 0) % 12, 1, 7);
    test_add( (s + 1) % 12, 1, 1);
    test_add( (s + 3) % 12, 1, 2);
    test_add( (s + 5) % 12, 1, 3);
    test_add( (s + 6) % 12, 1, 4);
    test_add( (s + 8) % 12, 1, 5);
    test_add( (s +10) % 12, 1, 6);

    test_add( (s + 0) % 12, 2, 5);
    test_add( (s + 2) % 12, 2, 6);
    test_add( (s + 4) % 12, 2, 7);
    test_add( (s + 5) % 12, 2, 1);
    test_add( (s + 7) % 12, 2, 2);
    test_add( (s + 9) % 12, 2, 3);
    test_add( (s +10) % 12, 2, 4);

    test_add( (s + 0) % 12, 3, 2);
    test_add( (s + 2) % 12, 3, 3);
    test_add( (s + 3) % 12, 3, 4);
    test_add( (s + 5) % 12, 3, 5);
    test_add( (s + 7) % 12, 3, 6);
    test_add( (s + 9) % 12, 3, 7);
    test_add( (s +10) % 12, 3, 1);

    test_add( (s + 0) % 12, 4, 6);
    test_add( (s + 2) % 12, 4, 7);
    test_add( (s + 3) % 12, 4, 1);
    test_add( (s + 5) % 12, 4, 2);
    test_add( (s + 7) % 12, 4, 3);
    test_add( (s + 8) % 12, 4, 4);
    test_add( (s +10) % 12, 4, 5);

    test_add( (s + 0) % 12, 5, 3);
    test_add( (s + 1) % 12, 5, 4);
    test_add( (s + 3) % 12, 5, 5);
    test_add( (s + 5) % 12, 5, 6);
    test_add( (s + 7) % 12, 5, 7);
    test_add( (s + 8) % 12, 5, 1);
    test_add( (s +10) % 12, 5, 2);

    let $fb = $('.test-fretboard');
    for(let i = 12, s = 0; i <= 15; ++i, ++s) {
      for(let j = 0; j < 6; ++j) {

        let $f = $(`#fret-${s}${j}`);
        if($f.length) {
          let $n = $f.clone();
          $n[0].id = '';
          $n[0].style.left = `${i * 66 + 9}px`;

          $fb.append($n[0]);
        }
      }
    }
  }

  let svg_1 = svg_data.number1;
  let svg_6 = svg_data.number6;
  async function test_add(x, y, number) {
    let container = document.createElement('div');
    let bg = document.createElement('div');
    let img = document.createElement('img');
    let $c = $(container);
    let $b = $(bg);
    let $i = $(img);

    container.id = `fret-${x}${y}`;

    let _y = [7, 60, 115, 169, 225, 280];
    let _s = ['e-h', 'B', 'G', 'D', 'A', 'E-l'];

    $c.attr('style', `left: ${66*x+9}px; top: ${_y[y]}px;`);
    $i.attr('src', `./svg/number${number}.svg`);

    $c.addClass(`i${number}`);
    $c.addClass(`fr${x}`);
    $c.addClass(`st${_s[y]}`);
    $c.addClass('test-container');
    $b.addClass('test-circle');
    $i.addClass('test-note');

    $c.append(bg);


    if(number == 1 || number == 6) {
      let span = document.createElement('span');
      span.style.position = 'absolute';

      if(number == 1 && svg_1) {
        span.innerHTML = svg_1;
        $c.append(span);
      }
      else if(number == 6 && svg_6) {
        span.innerHTML = svg_6;
        $c.append(span);
      }
      else {
        let result = await $.ajax(
          { url: `./svg/number${number}.svg`,
            dataType: 'text' } );

          let svg_image = result.replaceAll('800px', '55px');
          svg_image = svg_image.replace('svg fill="#000000"', `svg fill="#${number == 1 ? 'ff0000' : '004d00'}"`);
          svg_image = svg_image.replace(/<!--.*-->/g, '');
          svg_image = svg_image.replace(/<title>.*<\/title>/, '');
    
          span.innerHTML = svg_image;

          if(number == 1) {
            svg_1 = svg_image;
          } 
          else {
            svg_6 = svg_image;
          }

          $c.append(span);
      }
    }
    else {
      $c.append(img);
    }


    $('.test-fretboard').append(container);
  }

let keys = { };
keys.c   = 'C Major, C, D, E, F, G, A, B, C';
keys.am  = 'a minor, A, B, C, D, E, F, G, A';
keys.g   = 'G Major, G, A, B, C, D, E, F&sharp;, G';
keys.em  = 'e minor, E, F&sharp;, G, A, B, C, D, E';
keys.d   = 'D Major, D, E, F&sharp;, G, A, B, C&sharp;, D';
keys.bm  = 'b minor, B, C&sharp;, D, E, F&sharp;, G, A, B';
keys.a   = 'A Major, A, B, C&sharp;, D, E, F&sharp;, G&sharp;, A';
keys.fsm = 'f&sharp; minor, F&sharp;, G&sharp;, A, B, C&sharp;, D, E, F&sharp;';
keys.e   = 'E Major, E, F&sharp;, G&sharp;, A, B, C&sharp;, D&sharp;, E';
keys.csm = 'c&sharp; minor, C&sharp;, D&sharp;, E, F&sharp;, G&sharp;, A, B, C&sharp;';
keys.b   = 'B Major, B, C&sharp;, D&sharp;, E, F&sharp;, G&sharp;, A&sharp;, B';
keys.gsm = 'g&sharp; minor, G&sharp;, A&sharp;, B, C&sharp;, D&sharp;, E, F&sharp;, G&sharp;';
keys.f   = 'F Major, F, G, A, B&flat;, C, D, E, F';
keys.dm  = 'd minor, D, E, F, G, A, B&flat;, C, D';
keys.bf  = 'B&flat; Major, B&flat;, C, D, E&flat;, F, G, A, B&flat;';
keys.gm  = 'g minor, G, A, B&flat;, C, D, E&flat;, F, G';
keys.ef  = 'E&flat; Major, E&flat;, F, G, A&flat;, B&flat;, C, D, E&flat;';
keys.cm  = 'c minor, C, D, E&flat;, F, G, A&flat;, B&flat;, C';

keys.af  = 'A&flat; Major, A&flat;, B&flat;, C, D&flat;, E&flat;, F, G, A&flat;';
keys.fm  = 'f minor, F, G, A&flat;, B&flat;, C, D&flat;, E&flat;, F';

keys.df  = 'D&flat; Major, D&flat;, E&flat;, F, G&flat;, A&flat;, B&flat;, C, D&flat;';
keys.bfm = 'b&flat; minor, B&flat;, C, D&flat;, E&flat;, F, G&flat;, A&flat;, B&flat;';

keys.gf  = 'G&flat; Major, G&flat;, A&flat;, B&flat;, C&flat;, D&flat;, E&flat;, F, G&flat;';
keys.efm = 'e&flat; minor, E&flat;, F, G&flat;, A&flat;, B&flat;, C&flat;, D&flat;, E&flat;';

        function on_key_click(major_key, minor_key, sender) {
            
          let _keys = ['c', 'g', 'd', 'a', 'e', 'b', 'f',
                       'bf', 'ef', 'af', 'df', 'gf'];
          let $board = $('#board');
          let $scale = $('#board-bottom');
          $s = $(sender);


          _keys.forEach(key => {
              $board.removeClass('set-' + key);
              $scale.removeClass('scale-' + key);
          });

          for(let i = 1; i <= 13; ++i) {
              let $c = $('#sc-' + i );
              $c.html('');
              $c.removeClass('penta-omit');
              
          }


          let $pentatonic = $('#btn-pentatonic');
          let $triads = $('#btn-triads');
          let $minor = $('#btn-minor');
          let $selected = $('.selected');
          let was_minor = $selected.hasClass('selected-as-minor');
          $selected.removeClass('selected-as-minor');
          $selected.removeClass('selected');
          $s.addClass('selected');

          if($minor.hasClass('on')) {
            $s.addClass('selected-as-minor');
          }

          // if already selected, should it toggle to minor?
          
          // if($selected.length > 0 && $s.length > 0) {
          //   if($selected[0].id == $s[0].id) {
          //     if(!was_minor) {
          //       $s.addClass('selected-as-minor');
          //       // set up as minor
          //     }
          //     else {
          //       // set up as major
          //     }
          //   }
          // }


          $board.addClass('set-' + major_key);
          $scale.addClass('scale-' + major_key);

          let is_major = true;
          if($minor.hasClass('on')) {
            is_major = false;
            $('#major_header').addClass('hidden');
            $('#minor_header').removeClass('hidden');
          }
          else {
            $('#major_header').removeClass('hidden');
            $('#minor_header').addClass('hidden');
          }

          let _newkey = is_major ? major_key : minor_key;
          if(keys[_newkey]) {
            let k = keys[ _newkey ].split(', ');

            let is_5 = $pentatonic.hasClass('on');
            update_scale(k, is_major, is_5);
          }

          let fretkey = null;
          if(is_major) {
            console.log('major: ' + _newkey);
            fretkey = _newkey;
          }
          else {
            console.log('minor: ' + _newkey);
            fretkey = $s.attr('major');
          }

          if(fretkey) {

            notes_clear();

            if(fretkey.length == 1)
              fretkey = fretkey.toUpperCase();
            else if(fretkey.length == 2)
              fretkey = fretkey[0].toUpperCase() + fretkey[1];


            if(fret_key[fretkey]) {
              notes_load(fretkey);
            }
            else {
              console.log(fretkey + ' not found.');
            }
          }

          let offsets = {
            'c': 0,
            'df': 1,
            'd': 2,
            'ef': 3,
            'e': 4,
            'f': 5,
            'gf': 6,
            'g': 7,
            'af': 8,
            'a': 9,
            'bf': 10,
            'b': 11
          };

          let capitalizeFirstLetter = function (string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
          }

          let notes_frame = document.getElementById('notes_frame');
          notes_frame.src =  notes_frame.src.split('?')[0] + `?key=${capitalizeFirstLetter(major_key)}`;

          let pattern_frame = document.getElementById('pattern_frame');
          pattern_frame.src =  pattern_frame.src.split('?')[0] + `?key=${capitalizeFirstLetter(major_key)}&pattern`;

          test_load(offsets[fretkey.toLowerCase()]);
        }

        function update_scale(keys, is_major, is_5) {

          let k = keys;
          $('#sc-name' ).html(k[0]); 

          if(is_major) {
            $('#sc-1' ).html(k[1]); 
            $('#sc-3' ).html(k[2]); 
            $('#sc-5' ).html(k[3]); 
            $('#sc-6' ).html(k[4]); 
            $('#sc-8' ).html(k[5]); 
            $('#sc-10').html(k[6]); 
            $('#sc-12').html(k[7]); 
            $('#sc-13').html(k[8]); 

            if(is_5) {
              $('#sc-6' ).addClass('penta-omit');
              $('#sc-12' ).addClass('penta-omit');
            }
          }
          else {
            $('#sc-1' ).html(k[1]); 
            $('#sc-3' ).html(k[2]); 
            $('#sc-4' ).html(k[3]); 
            $('#sc-6' ).html(k[4]); 
            $('#sc-8' ).html(k[5]); 
            $('#sc-9' ).html(k[6]); 
            $('#sc-11').html(k[7]); 
            $('#sc-13').html(k[8]); 
            if(is_5) {
              $('#sc-3' ).addClass('penta-omit');
              $('#sc-9' ).addClass('penta-omit');
            }
          }

        }

        function board_toggle_class(css_class, sender) {
            let $board = $('#board');

            if(sender) {
                let $s = $(sender);
                if($s.hasClass('on') ) {
                    $s.removeClass('on');
                }
                else {
                    $s.addClass('on');
                }
            }

            if($board.hasClass(css_class)) {
                $board.removeClass(css_class);
                if(css_class === 'minor') {
                  console.log('minor toggle off');

                  // update buttons and scale
                } 
                else if(css_class === 'pentatonic') {
                  $('.penta-omit').removeClass('penta-omit');

                  $('.i4.hidden, .i7.hidden').removeClass('hidden');
                }
                else if(css_class === 'triads') {
                  $('.i2.hidden, .i4.hidden, .i6.hidden, .i7.hidden').removeClass('hidden');
                }

            }
            else {
                $board.addClass(css_class);
                if(css_class === 'minor') {
                  console.log('minor toggle on');

                  // update buttons and scale
                  // let $minor = $('#btn-minor');
                  // let is_major = $minor.hasClass('on');
                  // let _newkey = is_major ? major_key : minor_key;
                  // let k = keys[ _newkey ].split(', ');
                  // let is_5 = $pentatonic.hasClass('on');
                  // update_scale(k, is_major, is_5);
                }
                else if(css_class === 'pentatonic') {
                  // update penta scale notes
                  // let $minor = $('#btn-minor');
                  // let is_major = $minor.hasClass('on');
                  // let k = keys[ _newkey ].split(', ');
                  // let is_5 = $pentatonic.hasClass('on');
                  // update_scale(k, is_major, is_5);

                  $('.i4, .i7').addClass('hidden');
                }
                else if(css_class === 'triads') {
                  $('.i2, .i4, .i6, .i7').addClass('hidden');
                }
            }

        }

        function on_load() {

          let params = document.location.href.split('?');

          let args = null;

          if(params.length > 1) {

            args = {};

            let paramlist = params[1].split('&');


            for(let i = 0; i < paramlist.length; ++i) {
              let current = paramlist[i];
              let _arg = current.split('=');
              let arg = _arg[0];
              let val = _arg[1];

              args[arg] = val;
            }
          }
          console.log(args);


          if(args) {

            if(args['minor']) {
              let $btn = $('#btn-minor');
              $btn.addClass('on');
              board_toggle_class('minor');
            }

            if(args['no-flats']) {
              let $btn = $('#btn-no-flats');
              $btn.addClass('on');
              board_toggle_class('no-flats');
            }

            // these are exclusive so if more than one are in the url,
            // then the first one found will be used and the others are ignored.
            if(args['triads']) {
              let $btn = $('#btn-triads');
              $btn.addClass('on');
              board_toggle_class('triads');
            }
            else if(args['pentatonic']) {
              let $btn = $('#btn-pentatonic');
              $btn.addClass('on');
              board_toggle_class('pentatonic');
            }


            let accepted_major  = '_c_g_d_a_e_b_f_bf_ef_af_df_gf_';
            let accepted_minor = '_am_em_bm_fsm_csm_gsm_dm_gm_cm_fm_bfm_efm_';


            if(args.key) {
              if(accepted_major.indexOf('_' + args.key + '_') >= 0) {
                $button = $('[major="' + args.key + '"]');
                on_key_click($button.attr('major'), $button.attr('minor'), $button[0]);
              }
              else if(accepted_minor.indexOf('_' + args.key + '_') >= 0) {
                $button = $('[minor="' + args.key + '"]');
                on_key_click($button.attr('major'), $button.attr('minor'), $button[0]);
              }
            }
            else {
              on_key_click('c', 'am', $('#btn-c')[0]);
            }

          }
        }

        let sound = null;
        function play_track() {
            if(sound == null) {
                sound = new Howl({
                  src: ['./tracks/Basic-Shuffle-Groove-120-BPM.mp3'],
                  loop: true
                });
            }

          let $audio = $('#audio');
          if($audio.html().trim() == 'PLAY') {
            sound.play();
            $audio.html('STOP');
          }
          else if($audio.html().trim() == 'STOP') {
            sound.stop();
            $audio.html('PLAY');
          }
          
        }

        $(document).ready(on_load);

let note_data = {E: {}, A: {}, G: {}, B: {}, e: {}};

note_data.note = {};

//  [bg-x, bg-y, offset-x, offset-y, width, height, staff]        

note_data.note.none = [-152, -109];
note_data.note.staff_1 = [-14, -71, 3, 55, 20,  9];
note_data.note.staff_2 = [-14, -71, 3, 55, 20, 16];
note_data.note.staff_3 = [-14, -71, 3, 55, 20, 30];

note_data.note.staff_4 = [-14, -71, 5, -8, 20, 25];
note_data.note.staff_5 = [-14, -71, 5, -2, 20, 16];
note_data.note.staff_6 = [-14, -71, 5,  6, 20,  9];

note_data.note.e1 = [-351, -502, 2, 74, 19, 11, 3 ];
note_data.note.f1 = [-351, -502, 2, 71, 19, 11, 3 ];
note_data.note.g1 = [-351, -502, 0, 66, 19, 11, 2 ];
note_data.note.a1 = [-351, -502, 2, 63, 19, 11, 2 ];
note_data.note.b1 = [-351, -502, 1, 59, 19, 11, 1 ];
note_data.note.c1 = [-351, -502, 2, 55, 19, 11, 1 ];
note_data.note.d1 = [-351, -503, 0, 49, 19, 9  ];


note_data.note.e2 = [-351, -502, 0, 46, 19, 11 ];
note_data.note.f2 = [-351, -502, 3, 41, 19, 11 ];
note_data.note.g2 = [-351, -502, 0, 38, 19, 11 ];
note_data.note.a2 = [-351, -502, 0, 34, 19, 11 ];
note_data.note.b2 = [-351, -502, 0, 30, 19, 11 ];
note_data.note.c2 = [-351, -502, 0, 27, 19, 11 ];
note_data.note.d2 = [-351, -502, 0, 22, 19, 11 ];

note_data.note.e3 = [-351, -501, 3, 18, 19, 11 ];
note_data.note.f3 = [-351, -501, 3, 14, 19, 11 ];
note_data.note.g3 = [-351, -501, 3, 10, 19, 11 ];
note_data.note.a3 = [-351, -501, 3,  4, 19, 11, 6 ];
note_data.note.b3 = [-351, -501, 3,  1, 19, 11, 6 ];
note_data.note.c3 = [-351, -501, 3, -4, 19, 11, 5 ];
note_data.note.d3 = [-351, -501, 3, -8, 19, 11, 5 ];

note_data.note.e4 = [-351, -501, 3, 18, 19, 11 ];
note_data.note.f4 = [-79, -40];
note_data.note.g4 = [-218, -40];
note_data.note.a4 = [-348, -40];
note_data.note.b4 = [-484, -40];
note_data.note.c4 = [-883, -109];
note_data.note.d4 = [-683,-493, 0, -5];


// Fretboard locations
// ... = [left, top]
note_data.e = [14];
note_data.e[0] = [5, 40];
note_data.e[1] = [80, 40];
note_data.e[2] = [152, 40];
note_data.e[3] = [215, 40];

note_data.e[4] = [280, 40];
note_data.e[5] = [346, 40];
note_data.e[6] = [415, 40];
note_data.e[7] = [480, 40];

note_data.e[8]  = [545, 40];
note_data.e[9]  = [610, 40];
note_data.e[10] = [680, 40];
note_data.e[11] = [745, 40];

note_data.e[12] = [815, 40];
note_data.e[13] = [880, 40];

note_data.B = [14];
note_data.B[0] = [5, 109];
note_data.B[1] = [80, 109];
note_data.B[2] = [152, 109];
note_data.B[3] = [215, 109];

note_data.B[4] = [280, 109];
note_data.B[5] = [346, 109];
note_data.B[6] = [415, 109];
note_data.B[7] = [480, 109];

note_data.B[8]  = [545, 109];
note_data.B[9]  = [610, 109];
note_data.B[10] = [680, 109];
note_data.B[11] = [745, 109];

note_data.B[12] = [815, 109];
note_data.B[13] = [880, 109];


note_data.G = [14];
note_data.G[0] = [5, 178];
note_data.G[1] = [80, 178];
note_data.G[2] = [152, 178];
note_data.G[3] = [215, 178];

note_data.G[4] = [280, 178];
note_data.G[5] = [346, 178];
note_data.G[6] = [415, 178];
note_data.G[7] = [480, 178];

note_data.G[8]  = [545, 178];
note_data.G[9]  = [610, 178];
note_data.G[10] = [680, 178];
note_data.G[11] = [745, 178];

note_data.G[12] = [815, 178];
note_data.G[13] = [880, 178];

note_data.D = [14];
note_data.D[0] = [5, 248];
note_data.D[1] = [80, 248];
note_data.D[2] = [152, 248];
note_data.D[3] = [215, 248];

note_data.D[4] = [280, 248];
note_data.D[5] = [346, 248];
note_data.D[6] = [415, 248];
note_data.D[7] = [480, 248];

note_data.D[8]  = [545, 248];
note_data.D[9]  = [610, 248];
note_data.D[10] = [680, 248];
note_data.D[11] = [745, 248];

note_data.D[12] = [815, 248];
note_data.D[13] = [880, 248];

note_data.A = [14];
note_data.A[0] = [5, 317];
note_data.A[1] = [80, 317];
note_data.A[2] = [152, 317];
note_data.A[3] = [215, 317];

note_data.A[4] = [280, 317];
note_data.A[5] = [346, 317];
note_data.A[6] = [415, 317];
note_data.A[7] = [480, 317];

note_data.A[8]  = [545, 317];
note_data.A[9]  = [610, 317];
note_data.A[10] = [680, 317];
note_data.A[11] = [745, 317];

note_data.A[12] = [815, 317];
note_data.A[13] = [880, 317];

note_data.E = [14];
note_data.E[0] = [5, 386];
note_data.E[1] = [80, 386];
note_data.E[2] = [152, 386];
note_data.E[3] = [215, 386];

note_data.E[4] = [280, 386];
note_data.E[5] = [346, 386];
note_data.E[6] = [415, 386];
note_data.E[7] = [480, 386];

note_data.E[8]  = [545, 386];
note_data.E[9]  = [610, 386];
note_data.E[10] = [680, 386];
note_data.E[11] = [745, 386];

note_data.E[12] = [815, 386];
note_data.E[13] = [880, 386];


let fret_key = {};

fret_key.C = [
/*
[-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,
 */
[   'e3',   'f3',      0,   'g3',      0,   'a3',      0,   'b3',    'c3',     0,   'd3',      0,   'e4',   'f4' ],                     
[   'b2',   'c2',      0,   'd2',      0,   'e3',   'f3',      0,    'g3',     0,   'a3',      0,   'b3',   'c3' ],                     
[   'g2',      0,   'a2',      0,   'b2',   'c2',      0,   'd2',       0,  'e3',   'f3',      0,   'g3',      0 ],
[   'd1',      0,   'e2',   'f2',      0,   'g2',      0,   'a2',       0,  'b2',   'c2',      0,   'd2',      0 ],
[   'a1',      0,   'b1',   'c1',      0,   'd1',      0,   'e2',    'f2',     0,   'g2',      0,   'a2',      0 ],
[   'e1',   'f1',      0,   'g1',      0,   'a1',      0,   'b1',    'c1',     0,   'd1',      0,   'e2',   'f2' ],
];


fret_key.G = [
/*
[-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,
 */
[   'e3',      0, 'f3.s',   'g3',      0,   'a3',      0,   'b3',   'c3',      0,   'd3',      0,  'e4',      0 ],                     
[   'b2',   'c2',      0,   'd2',     0,    'e3',      0, 'f3.s',   'g3',      0,   'a3',      0,  'b3',      0 ],                     
[   'g2',      0,   'a2',      0,   'b2',   'c2',      0,   'd2',      0,   'e3',      0, 'f3.s',  'g3',      0 ],
[   'd1',      0,   'e2',      0, 'f2.s',   'g2',      0,   'a2',      0,   'b2',   'c2',      0,  'd2',      0 ],
[   'a1',      0,   'b1',   'c1',      0,   'd1',      0,   'e2',      0, 'f2.s',   'g2',      0,  'a2',      0 ],
[   'e1',      0, 'f1.s',   'g1',      0,   'a1',      0,   'b1',   'c1',      0,   'd1',      0,  'e2',      0 ],
];

fret_key.D = [
/*
[-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,
 */
[   'e3',      0, 'f3.s',   'g3',      0,   'a3',      0,   'b3',      0, 'c3.s',   'd3',      0,  'e4',      0 ],                     
[   'b2',      0, 'c2.s',   'd2',      0,   'e3',      0, 'f3.s',   'g3',      0,   'a3',      0,  'b3',      0 ],                     
[   'g2',      0,   'a2',      0,   'b2',      0, 'c2.s',   'd2',      0,   'e3',      0, 'f3.s',  'g3',      0 ],
[   'd1',      0,   'e2',      0, 'f2.s',   'g2',      0,   'a2',      0,   'b2',      0, 'c2.s',  'd2',      0 ],
[   'a1',      0,   'b1',      0, 'c1.s',   'd1',      0,   'e2',      0, 'f2.s',   'g2',      0,  'a2',      0 ],
[   'e1',      0, 'f1.s',   'g1',      0,   'a1',      0,   'b1',      0, 'c1.s',   'd1',      0,  'e2',      0 ],
];

fret_key.A = [
/*
[-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,
 */
[   'e3',      0, 'f3.s',      0, 'g3.s',   'a3',      0,   'b3',      0, 'c3.s',   'd3',      0,  'e4',      0 ],                     
[   'b2',      0, 'c2.s',   'd2',      0,   'e3',      0, 'f3.s',      0, 'g3.s',   'a3',      0,  'b3',      0 ],                     
[      0, 'g2.s',   'a2',      0,   'b2',      0, 'c2.s',   'd2',      0,   'e3',      0, 'f3.s',  'g3',      0 ],
[   'd1',      0,   'e2',      0, 'f2.s',      0, 'g2.s',   'a2',      0,   'b2',      0, 'c2.s',  'd2',      0 ],
[   'a1',      0,   'b1',      0, 'c1.s',   'd1',      0,   'e2',      0, 'f2.s',      0, 'g2.s',  'a2',      0 ],
[   'e1',      0, 'f1.s',      0, 'g1.s',   'a1',      0,   'b1',      0, 'c1.s',   'd1',      0,  'e2',      0 ],
];

fret_key.E = [
/*
[-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,
 */
[   'e3',      0, 'f3.s',      0, 'g3.s',   'a3',      0,   'b3',      0, 'c3.s',      0, 'd3.s',  'e4',      0 ],                     
[   'b2',      0, 'c2.s',      0, 'd2.s',   'e3',      0, 'f3.s',      0, 'g3.s',   'a3',      0,  'b3',      0 ],                     
[      0, 'g2.s',   'a2',      0,   'b2',      0, 'c2.s',      0, 'd2.s',   'e3',      0, 'f3.s',  'g3',      0 ],
[      0, 'd1.s',   'e2',      0, 'f2.s',      0, 'g2.s',   'a2',      0,   'b2',      0, 'c2.s',  'd2',      0 ],
[   'a1',      0,   'b1',      0, 'c1.s',      0, 'd1.s',   'e2',      0, 'f2.s',      0, 'g2.s',  'a2',      0 ],
[   'e1',      0, 'f1.s',      0, 'g1.s',   'a1',      0,   'b1',      0, 'c1.s',      0, 'd1.s',  'e2',      0 ],
];

fret_key.B = [
/*
[-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,
 */
[   'e3',      0, 'f3.s',      0, 'g3.s',      0, 'a3.s',   'b3',      0, 'c3.s',      0, 'd3.s',  'e4',      0 ],                     
[   'b2',      0, 'c2.s',      0, 'd2.s',   'e3',      0, 'f3.s',      0, 'g3.s',      0, 'a3.s',  'b3',      0 ],                     
[      0, 'g2.s',      0, 'a2.s',   'b2',      0, 'c2.s',      0, 'd2.s',   'e3',      0, 'f3.s',  'g3',      0 ],
[      0, 'd1.s',   'e2',      0, 'f2.s',      0, 'g2.s',      0, 'a2.s',   'b2',      0, 'c2.s',  'd2',      0 ],
[      0, 'a1.s',   'b1',      0, 'c1.s',      0, 'd1.s',   'e2',      0, 'f2.s',      0, 'g2.s',  'a2',      0 ],
[   'e1',      0, 'f1.s',      0, 'g1.s',      0, 'a1.s',   'b1',      0, 'c1.s',      0, 'd1.s',  'e2',      0 ],
];

fret_key.F = [
/*
[-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,
 */
[   'e3',   'f3',      0,   'g3',      0,   'a3', 'b3.f',      0,   'c3',      0,   'd3',      0,   'e4',   'f4' ],                     
[      0,   'c2',      0,   'd2',      0,   'e3',   'f3',      0,   'g3',      0,   'a3', 'b3.f',      0,   'c3' ],                     
[   'g2',      0,   'a2', 'b2.f',      0,   'c2',      0,   'd2',      0,   'e3',   'f3',      0,   'g3',      0 ],
[   'd1',      0,   'e2',   'f2',      0,   'g2',      0,   'a2', 'b2.f',      0,   'c2',      0,   'd2',      0 ],
[   'a1', 'b1.f',      0,   'c1',      0,   'd1',      0,   'e2',   'f2',      0,   'g2',      0,   'a2',      0 ],
[   'e1',   'f1',      0,   'g1',      0,   'a1', 'b1.f',      0,   'c1',      0,   'd1',      0,   'e2',   'f2' ],
];

fret_key.Bf = [
/*
[-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,
 */
[      0,   'f3',      0,   'g3',      0,   'a3', 'b3.f',      0,   'c3',      0,   'd3', 'e4.f',      0,   'f4' ],                     
[      0,   'c2',      0,   'd2', 'e3.f',      0,   'f3',      0,   'g3',      0,   'a3', 'b3.f',      0,   'c3' ],                     
[   'g2',      0,   'a2', 'b2.f',      0,   'c2',      0,   'd2', 'e3.f',      0,   'f3',      0,   'g3',      0 ],
[   'd1', 'e2.f',      0,   'f2',      0,   'g2',      0,   'a2', 'b2.f',      0,   'c2',      0,   'd2', 'e3.f' ],
[   'a1', 'b1.f',      0,   'c1',      0,   'd1', 'e2.f',      0,   'f2',      0,   'g2',      0,   'a2', 'b2.f' ],
[      0,   'f1',      0,   'g1',      0,   'a1', 'b1.f',      0,   'c1',      0,   'd1', 'e2.f',      0,   'f2' ],
];

fret_key.Ef = [
/*
[-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,
 */
[      0,   'f3',      0,   'g3', 'a3.f',      0, 'b3.f',      0,   'c3',      0,   'd3', 'e4.f',      0,   'f4' ],                     
[      0,   'c2',      0,   'd2', 'e3.f',      0,   'f3',      0,   'g3', 'a3.f',      0, 'b3.f',      0,   'c3' ],                     
[   'g2', 'a2.f',      0, 'b2.f',      0,   'c2',      0,   'd2', 'e3.f',      0,   'f3',      0,   'g3', 'a3.f' ],
[   'd1', 'e2.f',      0,   'f2',      0,   'g2', 'a2.f',      0, 'b2.f',      0,   'c2',      0,   'd2', 'e3.f' ],
[      0, 'b1.f',      0,   'c1',      0,   'd1', 'e2.f',      0,   'f2',      0,   'g2', 'a2.f',      0, 'b2.f' ],
[      0,   'f1',      0,   'g1', 'a1.f',      0, 'b1.f',      0,   'c1',      0,   'd1', 'e2.f',      0,   'f2' ],
];

fret_key.Af = [
/*
[-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,
 */
[      0,   'f3',      0,   'g3', 'a3.f',      0, 'b3.f',      0,   'c3', 'd3.f',      0, 'e4.f',      0,   'f4' ],                     
[      0,   'c2', 'd2.f',      0, 'e3.f',      0,   'f3',      0,   'g3', 'a3.f',      0, 'b3.f',      0,   'c3' ],                     
[   'g2', 'a2.f',      0, 'b2.f',      0,   'c2', 'd2.f',      0, 'e3.f',      0,   'f3',      0,   'g3', 'a3.f' ],
[      0, 'e2.f',      0,   'f2',      0,   'g2', 'a2.f',      0, 'b2.f',      0,   'c2', 'd2.f',      0, 'e3.f' ],
[      0, 'b1.f',      0,   'c1', 'd1.f',      0, 'e2.f',      0,   'f2',      0,   'g2', 'a2.f',      0, 'b2.f' ],
[      0,   'f1',      0,   'g1', 'a1.f',      0, 'b1.f',      0,   'c1', 'd1.f',      0, 'e2.f',      0,   'f2' ],
];

fret_key.Df = [
/*
[-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,
 */
[      0,   'f3', 'g3.f',      0, 'a3.f',      0, 'b3.f',      0,   'c3', 'd3.f',      0, 'e4.f',      0,   'f4' ],                     
[      0,   'c2', 'd2.f',      0, 'e3.f',      0,   'f3', 'g3.f',      0, 'a3.f',      0, 'b3.f',      0,   'c3' ],                     
[      0, 'a2.f',      0, 'b2.f',      0,   'c2', 'd2.f',      0, 'e3.f',      0,   'f3', 'g3.f',      0, 'a3.f' ],
[      0, 'e2.f',      0,   'f2', 'g2.f',      0, 'a2.f',      0, 'b2.f',      0,   'c2', 'd2.f',      0, 'e3.f' ],
[      0, 'b1.f',      0,   'c1', 'd1.f',      0, 'e2.f',      0,   'f2', 'g2.f',      0, 'a2.f',      0, 'b3.f' ],
[      0,   'f1', 'g1.f',      0, 'a1.f',      0, 'b1.f',      0,   'c1', 'd1.f',      0, 'e2.f',      0,   'f2' ],
];

fret_key.Gf = [
/*
[-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,
 */
[      0,   'f3', 'g3.f',      0, 'a3.f',      0, 'b3.f', 'c3.f',      0, 'd3.f',      0, 'e4.f',      0,   'f4' ],                     
[ 'c2.f',      0, 'd2.f',      0, 'e3.f',      0,   'f3', 'g3.f',      0, 'a3.f',      0, 'b3.f', 'c3.f',     0  ],                     
[      0, 'a2.f',      0, 'b2.f', 'c2.f',      0, 'd2.f',      0, 'e3.f',      0,   'f3', 'g3.f',      0, 'a3.f' ],
[      0, 'e2.f',      0,   'f2', 'g2.f',      0, 'a2.f',      0, 'b2.f', 'c2.f',      0, 'd2.f',      0, 'e3.f' ],
[      0, 'b1.f', 'c1.f',      0, 'd1.f',      0, 'e2.f',      0,   'f2', 'g2.f',      0, 'a2.f',      0, 'b3.f' ],
[      0,   'f1', 'g1.f',      0, 'a1.f',      0, 'b1.f', 'c1.f',      0, 'd1.f',      0, 'e2.f',      0,   'f2' ],
];



        function notes_load(key_to_load) {
          let key = fret_key[key_to_load];
          if(!key) {
            console.log('Key not found');
            return;
          }

          let _string = ['e', 'B', 'G', 'D', 'A', 'E'];

          for(let i = 0; i < 6; ++i) {
            for(let j = 0; j < 14; ++j) {
              let note = key[i][j];
              if(note) {
                let s = null;
                if(note.length > 2) {
                  let n = note.split('.');
                  note = n[0];
                  s = n[1];
                }
                let string = _string[i];
                let fret = j;

                notes_add(note, string, fret, s);
              }
            }
          }
        }

        function notes_clear() {
          $('#notes').empty();
        }

        function notes_add(note, string, fret, s) {
          let div = document.createElement('div');
          let $div = $(div);
          $div.addClass('note');
          if(s) {
            $div.addClass(note + '.' + s);
            if(note.indexOf('staff') < 0) {
              $div.attr('title', (note[0].toUpperCase() + (s == 's' ? '#' : 'b') + ' ' + note[1]));
            }
          }
          else {
            $div.addClass(note);
            if(note.indexOf('staff') < 0) {
              $div.attr('title', note[0].toUpperCase() + ' ' + note[1]);
            }
          }


          let _note = note_data.note[note];
          let left = note_data[string][fret][0];
          let _top = note_data[string][fret][1] ;

          if(_note.length >= 3) {
            left += _note[2];
          }

          if(_note.length >= 4) {
            _top += _note[3];
          }

          let width = null;
          let height = null;
          if(_note.length >= 6) {
            width = _note[4];
            height = _note[5];
          }

          if(_note.length >= 7) {
            notes_add('staff_' + _note[6], string, fret)
          }

          let _s = null;

          if(s) {
            if(s === 's') {
              left += 3;
              _s = document.createElement('div');
              let $_s= $(_s);
              $_s.addClass('sharp');
              $_s.attr('style', `
                    left: ${left - 9}px;
                    top: ${_top - 6}px; `);

            }
            else if(s === 'f') {
              left += 3;
              _s = document.createElement('div');
              let $_s= $(_s);
              $_s.addClass('flat');
              $_s.attr('style', `
                    left: ${left - 9}px;
                    top: ${_top - 10}px; `);
            }
          }


          let style = `background-position: ${_note[0]}px ${_note[1]}px;
          left: ${left}px;
          top: ${_top}px; `;

          if(width != null && height != null) {
            style += ` width: ${width}px; height: ${height}px;`;
          }

          $div.attr('style', style);


          $('#notes').append(div);


          if(_s)
            $('#notes').append(_s);
        }

    </script>
</html>
