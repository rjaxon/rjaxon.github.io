<html>
    <head>
        <!--script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.26/Tone.js"></script-->
    </head>


<style>

.header {
    position: absolute;
    font-size: 30px;
    font-weight: bold;
}

.bars {
    position: relative;
    background-image: url(./my-bars.svg);
    width: 942px;
    height: 60px;
    background-repeat: no-repeat;
    background-position-y: 10px;
}

.note-container {
    position: absolute;
}

.accidental {
    position: absolute;
    font-size: 14px;
    font-weight: bolder;
    background: white;
}

.flat {
    top: -7px;
    left: -3px;
}
.sharp {
    top: -2px;
    left: -3px;
}

.natural {
    top: -7px;
    left: -3px;
    font-size: 16px;
}

.note {
    position: absolute;
    height: 10px;
    left: 7px;
}

.note-bar {
    left: 4px;
}

</style>

<my-notes-fretboard ></my-notes-fretboard>

<body>

    <div>
        <div style="position: relative;height: 10px; width: 942px;">
                <span class="header" style="left: 237px;">3</span>
                <span class="header" style="left: 371px;">5</span>
                <span class="header" style="left: 501px;">7</span>
                <span class="header" style="left: 634px;">9</span>
                <span class="header" style="left: 823px;">12</span>
        </div>
        <div style="padding-top: 3em;">
            <div id="string-high-e" class="bars"> </div>
            <div id="string-b"      class="bars"> </div>
            <div id="string-g"      class="bars"> </div>
            <div id="string-d"      class="bars"> </div>
            <div id="string-a"      class="bars"> </div>
            <div id="string-low-e"  class="bars"> </div>
    
        </div>
    </div>

</body>
    <script type="text/javascript">

        function clearNotes() {
            let strings = ['low-e', 'a', 'd', 'g', 'b', 'high-e'];

            strings.forEach( (s) => {
                let parent = document.getElementById(`string-${s}`);
                while (parent.firstChild) {
                    parent.removeChild(parent.firstChild);
                }
            });
        }

        function loadNotes(major_key) {
            let strings = ['low-e', 'a', 'd', 'g', 'b', 'high-e'].reverse();
            let key = {}

key.C = [
/*------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------, */
[   'e3',   'f3',      0,   'g3',      0,   'a3',      0,   'b3',    'c3',     0,   'd3',      0,   'e4',   'f4' ],                     
[   'b2',   'c2',      0,   'd2',      0,   'e3',   'f3',      0,    'g3',     0,   'a3',      0,   'b3',   'c3' ],                     
[   'g2',      0,   'a2',      0,   'b2',   'c2',      0,   'd2',       0,  'e3',   'f3',      0,   'g3',      0 ],
[   'd1',      0,   'e2',   'f2',      0,   'g2',      0,   'a2',       0,  'b2',   'c2',      0,   'd2',      0 ],
[   'a1',      0,   'b1',   'c1',      0,   'd1',      0,   'e2',    'f2',     0,   'g2',      0,   'a2',      0 ],
[   'e1',   'f1',      0,   'g1',      0,   'a1',      0,   'b1',    'c1',     0,   'd1',      0,   'e2',   'f2' ],
];

key.G = [
/*------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------, */
[   'e3',      0, 'f3.s',   'g3',      0,   'a3',      0,   'b3',   'c3',      0,   'd3',      0,  'e4',      0 ],                     
[   'b2',   'c2',      0,   'd2',      0,   'e3',      0, 'f3.s',   'g3',      0,   'a3',      0,  'b3',      0 ],                     
[   'g2',      0,   'a2',      0,   'b2',   'c2',      0,   'd2',      0,   'e3',      0, 'f3.s',  'g3',      0 ],
[   'd1',      0,   'e2',      0, 'f2.s',   'g2',      0,   'a2',      0,   'b2',   'c2',      0,  'd2',      0 ],
[   'a1',      0,   'b1',   'c1',      0,   'd1',      0,   'e2',      0, 'f2.s',   'g2',      0,  'a2',      0 ],
[   'e1',      0, 'f1.s',   'g1',      0,   'a1',      0,   'b1',   'c1',      0,   'd1',      0,  'e2',      0 ],
];

key.D = [
/*------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------, */
[   'e3',      0, 'f3.s',   'g3',      0,   'a3',      0,   'b3',      0, 'c3.s',   'd3',      0,  'e4',      0 ],                     
[   'b2',      0, 'c2.s',   'd2',      0,   'e3',      0, 'f3.s',   'g3',      0,   'a3',      0,  'b3',      0 ],                     
[   'g2',      0,   'a2',      0,   'b2',      0, 'c2.s',   'd2',      0,   'e3',      0, 'f3.s',  'g3',      0 ],
[   'd1',      0,   'e2',      0, 'f2.s',   'g2',      0,   'a2',      0,   'b2',      0, 'c2.s',  'd2',      0 ],
[   'a1',      0,   'b1',      0, 'c1.s',   'd1',      0,   'e2',      0, 'f2.s',   'g2',      0,  'a2',      0 ],
[   'e1',      0, 'f1.s',   'g1',      0,   'a1',      0,   'b1',      0, 'c1.s',   'd1',      0,  'e2',      0 ],
];

key.A = [
/*------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------, */
[   'e3',      0, 'f3.s',      0, 'g3.s',   'a3',      0,   'b3',      0, 'c3.s',   'd3',      0,  'e4',      0 ],                     
[   'b2',      0, 'c2.s',   'd2',      0,   'e3',      0, 'f3.s',      0, 'g3.s',   'a3',      0,  'b3',      0 ],                     
[      0, 'g2.s',   'a2',      0,   'b2',      0, 'c2.s',   'd2',      0,   'e3',      0, 'f3.s',  'g3',      0 ],
[   'd1',      0,   'e2',      0, 'f2.s',      0, 'g2.s',   'a2',      0,   'b2',      0, 'c2.s',  'd2',      0 ],
[   'a1',      0,   'b1',      0, 'c1.s',   'd1',      0,   'e2',      0, 'f2.s',      0, 'g2.s',  'a2',      0 ],
[   'e1',      0, 'f1.s',      0, 'g1.s',   'a1',      0,   'b1',      0, 'c1.s',   'd1',      0,  'e2',      0 ],
];

key.E = [
/*------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------, */
[   'e3',      0, 'f3.s',      0, 'g3.s',   'a3',      0,   'b3',      0, 'c3.s',      0, 'd3.s',  'e4',      0 ],                     
[   'b2',      0, 'c2.s',      0, 'd2.s',   'e3',      0, 'f3.s',      0, 'g3.s',   'a3',      0,  'b3',      0 ],                     
[      0, 'g2.s',   'a2',      0,   'b2',      0, 'c2.s',      0, 'd2.s',   'e3',      0, 'f3.s',  'g3',      0 ],
[      0, 'd1.s',   'e2',      0, 'f2.s',      0, 'g2.s',   'a2',      0,   'b2',      0, 'c2.s',  'd2',      0 ],
[   'a1',      0,   'b1',      0, 'c1.s',      0, 'd1.s',   'e2',      0, 'f2.s',      0, 'g2.s',  'a2',      0 ],
[   'e1',      0, 'f1.s',      0, 'g1.s',   'a1',      0,   'b1',      0, 'c1.s',      0, 'd1.s',  'e2',      0 ],
];

key.B = [
/*------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------, */
[   'e3',      0, 'f3.s',      0, 'g3.s',      0, 'a3.s',   'b3',      0, 'c3.s',      0, 'd3.s',  'e4',      0 ],                     
[   'b2',      0, 'c2.s',      0, 'd2.s',   'e3',      0, 'f3.s',      0, 'g3.s',      0, 'a3.s',  'b3',      0 ],                     
[      0, 'g2.s',      0, 'a2.s',   'b2',      0, 'c2.s',      0, 'd2.s',   'e3',      0, 'f3.s',  'g3',      0 ],
[      0, 'd1.s',   'e2',      0, 'f2.s',      0, 'g2.s',      0, 'a2.s',   'b2',      0, 'c2.s',  'd2',      0 ],
[      0, 'a1.s',   'b1',      0, 'c1.s',      0, 'd1.s',   'e2',      0, 'f2.s',      0, 'g2.s',  'a2',      0 ],
[   'e1',      0, 'f1.s',      0, 'g1.s',      0, 'a1.s',   'b1',      0, 'c1.s',      0, 'd1.s',  'e2',      0 ],
];

key.F = [
/*------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------, */
[   'e3',   'f3',      0,   'g3',      0,   'a3', 'b3.f',      0,   'c3',      0,   'd3',      0,   'e4',   'f4' ],                     
[      0,   'c2',      0,   'd2',      0,   'e3',   'f3',      0,   'g3',      0,   'a3', 'b3.f',      0,   'c3' ],                     
[   'g2',      0,   'a2', 'b2.f',      0,   'c2',      0,   'd2',      0,   'e3',   'f3',      0,   'g3',      0 ],
[   'd1',      0,   'e2',   'f2',      0,   'g2',      0,   'a2', 'b2.f',      0,   'c2',      0,   'd2',      0 ],
[   'a1', 'b1.f',      0,   'c1',      0,   'd1',      0,   'e2',   'f2',      0,   'g2',      0,   'a2',      0 ],
[   'e1',   'f1',      0,   'g1',      0,   'a1', 'b1.f',      0,   'c1',      0,   'd1',      0,   'e2',   'f2' ],
];

key.Bf = [
/*------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------, */
[      0,   'f3',      0,   'g3',      0,   'a3', 'b3.f',      0,   'c3',      0,   'd3', 'e4.f',      0,   'f4' ],                     
[      0,   'c2',      0,   'd2', 'e3.f',      0,   'f3',      0,   'g3',      0,   'a3', 'b3.f',      0,   'c3' ],                     
[   'g2',      0,   'a2', 'b2.f',      0,   'c2',      0,   'd2', 'e3.f',      0,   'f3',      0,   'g3',      0 ],
[   'd1', 'e2.f',      0,   'f2',      0,   'g2',      0,   'a2', 'b2.f',      0,   'c2',      0,   'd2', 'e3.f' ],
[   'a1', 'b1.f',      0,   'c1',      0,   'd1', 'e2.f',      0,   'f2',      0,   'g2',      0,   'a2', 'b2.f' ],
[      0,   'f1',      0,   'g1',      0,   'a1', 'b1.f',      0,   'c1',      0,   'd1', 'e2.f',      0,   'f2' ],
];

key.Ef = [
/*------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------, */
[      0,   'f3',      0,   'g3', 'a3.f',      0, 'b3.f',      0,   'c3',      0,   'd3', 'e4.f',      0,   'f4' ],                     
[      0,   'c2',      0,   'd2', 'e3.f',      0,   'f3',      0,   'g3', 'a3.f',      0, 'b3.f',      0,   'c3' ],                     
[   'g2', 'a2.f',      0, 'b2.f',      0,   'c2',      0,   'd2', 'e3.f',      0,   'f3',      0,   'g3', 'a3.f' ],
[   'd1', 'e2.f',      0,   'f2',      0,   'g2', 'a2.f',      0, 'b2.f',      0,   'c2',      0,   'd2', 'e3.f' ],
[      0, 'b1.f',      0,   'c1',      0,   'd1', 'e2.f',      0,   'f2',      0,   'g2', 'a2.f',      0, 'b2.f' ],
[      0,   'f1',      0,   'g1', 'a1.f',      0, 'b1.f',      0,   'c1',      0,   'd1', 'e2.f',      0,   'f2' ],
];

key.Af = [
/*------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------, */
[      0,   'f3',      0,   'g3', 'a3.f',      0, 'b3.f',      0,   'c3', 'd3.f',      0, 'e4.f',      0,   'f4' ],                     
[   'b2',   'c2', 'd2.f',      0, 'e3.f',      0,   'f3',      0,   'g3', 'a3.f',      0, 'b3.f',      0,   'c3' ],                     
[      0, 'a2.f',      0, 'b2.f',      0,   'c2', 'd2.f',      0, 'e3.f',      0,   'f3',      0,   'g3', 'a3.f' ],
[      0, 'e2.f',      0,   'f2',      0,   'g2', 'a2.f',      0, 'b2.f',      0,   'c2', 'd2.f',      0, 'e3.f' ],
[      0, 'b1.f',      0,   'c1', 'd1.f',      0, 'e2.f',      0,   'f2',      0,   'g2', 'a2.f',      0, 'b2.f' ],
[      0,   'f1',      0,   'g1', 'a1.f',      0, 'b1.f',      0,   'c1', 'd1.f',      0, 'e2.f',      0,   'f2' ],
];

key.Df = [
/*------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------, */
[      0,   'f3', 'g3.f',      0, 'a3.f',      0, 'b3.f',      0,   'c3', 'd3.f',      0, 'e4.f',      0,   'f4' ],                     
[      0,   'c2', 'd2.f',      0, 'e3.f',      0,   'f3', 'g3.f',      0, 'a3.f',      0, 'b3.f',      0,   'c3' ],                     
[      0, 'a2.f',      0, 'b2.f',      0,   'c2', 'd2.f',      0, 'e3.f',      0,   'f3', 'g3.f',      0, 'a3.f' ],
[      0, 'e2.f',      0,   'f2', 'g2.f',      0, 'a2.f',      0, 'b2.f',      0,   'c2', 'd2.f',      0, 'e3.f' ],
[      0, 'b1.f',      0,   'c1', 'd1.f',      0, 'e2.f',      0,   'f2', 'g2.f',      0, 'a2.f',      0, 'b3.f' ],
[      0,   'f1', 'g1.f',      0, 'a1.f',      0, 'b1.f',      0,   'c1', 'd1.f',      0, 'e2.f',      0,   'f2' ],
];

key.Gf = [
/*------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------,-------, */
[      0,   'f3', 'g3.f',      0, 'a3.f',      0, 'b3.f', 'c3.f',      0, 'd3.f',      0, 'e4.f',      0,   'f4' ],                     
[ 'c2.f',      0, 'd2.f',      0, 'e3.f',      0,   'f3', 'g3.f',      0, 'a3.f',      0, 'b3.f', 'c3.f',     0  ],                     
[      0, 'a2.f',      0, 'b2.f', 'c2.f',      0, 'd2.f',      0, 'e3.f',      0,   'f3', 'g3.f',      0, 'a3.f' ],
[      0, 'e2.f',      0,   'f2', 'g2.f',      0, 'a2.f',      0, 'b2.f', 'c2.f',      0, 'd2.f',      0, 'e3.f' ],
[      0, 'b1.f', 'c1.f',      0, 'd1.f',      0, 'e2.f',      0,   'f2', 'g2.f',      0, 'a2.f',      0, 'b3.f' ],
[      0,   'f1', 'g1.f',      0, 'a1.f',      0, 'b1.f', 'c1.f',      0, 'd1.f',      0, 'e2.f',      0,   'f2' ],
];

            strings.forEach( (s, index) => {
                let notes = key[major_key || 'C'][index];
                if(notes) {
                    notes.forEach( (n, fret) => {
                        if(n) {
                            let _n = n.split('.');
                            let a = 0;
                            if(_n.length > 1) {
                                switch(_n[1]) {
                                    case 's': a = 1; break;
                                    case 'f': a = 2; break;
                                }
                            }
                            addNote(s, _n[0], fret, a);
                        }
                    } );
                }
            } );
        }

        function addNote(string, note, fret, accidental /*1 sharp, 2 flat, 3 natural */) {

            if(!note) return;

            let notes = {
                // [ top, 
                //   bar {1: low-1, 2: low-2, 3: low-3, 4: high-1, 5: high-2, 6: high-3},
                // ]
                e1: [ 66, 3],
                f1: [ 62, 3],
                g1: [ 58, 2],
                a1: [ 54, 2],
                b1: [ 50, 1],
                c1: [ 46, 1],
                d1: [ 42, 0],
                e2: [ 38, 0],
                f2: [ 34, 0],
                g2: [ 30, 0],
                a2: [ 26, 0],
                b2: [ 22, 0],
                c2: [ 18, 0],
                d2: [ 14, 0],
                e3: [ 10, 0],
                f3: [  6, 0],
                g3: [  2, 0],
                a3: [ -1, 4],
                b3: [ -5, 4],
                c3: [ -8, 5],
                d3: [-12, 5],

                e4: [-16, 6],
                f4: [-20, 6],
                g4: [  2, 0],
                a4: [ -1, 4],
                b4: [ -5, 4],
                c4: [ -8, 5],
                d4: [-12, 5]
            };

            let frets = [ 30, 104, 167, 234, 300, 367, 432, 497, 565, 629, 695, 760, 827, 893 ];

            let n = notes[note];
            if(n && n.length) {
                let container = document.createElement('span');
                container.classList.add('note-container');
                container.style.top = `${n[0]}px`;
                container.style.left = `${frets[fret]}px`;
                
                let extra_bars = null;
                if(n.length > 1) {
                    let createExtra = function(left, top) {
                        let extra = document.createElement('img');
                        extra.style.position = 'absolute';
                        extra.src = './my-staff-bar.svg';
                        if(left)
                            extra.style.left = `${left}px`;
                        if(top)
                            extra.style.top = `${top}px`;
                        return extra;
                    }
                    switch(n[1]) {
                        case 1:
                            extra_bars = [createExtra(frets[fret] + 3, 46)];
                            break;
                        case 2:
                            extra_bars = [
                                createExtra(frets[fret] + 3, 46),
                                createExtra(frets[fret] + 3, 54)
                            ];
                            break;
                        case 3:
                            extra_bars = [
                                createExtra(frets[fret] + 3, 46),
                                createExtra(frets[fret] + 3, 54),
                                createExtra(frets[fret] + 3, 62)
                            ];
                            break;
                        case 4:
                            extra_bars = [createExtra(frets[fret] + 3, -1)];
                            break;
                        case 5:
                            extra_bars = [
                                createExtra(frets[fret] + 3, -1),
                                createExtra(frets[fret] + 3, -8),
                            ];
                            break;
                        case 6:
                            extra_bars = [
                                createExtra(frets[fret] + 3, -1),
                                createExtra(frets[fret] + 3, -8),
                                createExtra(frets[fret] + 3, -16)
                            ];
                            break;
                    }
                    
                }

                if(accidental) {
                    let span2 = document.createElement('span');
                    span2.classList.add('accidental');
                    let acc = '';
                    switch(accidental) {
                        case 1:
                            acc = 'sharp';
                            break;
                        case 2:
                            acc = 'flat';
                            break;
                        case 3:
                            acc = 'natural';
                            break;
                    }
                    span2.classList.add(acc);
                    span2.innerHTML = `&${acc};`;
                    container.appendChild(span2);
                }

                let img = document.createElement('img');
                img.src = './my-note.svg';
                img.classList.add('note');
                let _note = note.toUpperCase();
                if(accidental) {
                    if(accidental == 1) _note += '.s';
                    if(accidental == 2) _note += '.f';
                }
                img.alt = container.title = _note;

                container.appendChild(img);


                let _string = document.getElementById(`string-${string}`);
                if(_string) {
                    if(extra_bars)
                        extra_bars.forEach( (b) => {_string.appendChild(b); } );
                    _string.appendChild(container);
                }
            }
        }

        // TODO: lookup tone.js
        // function playTone() {
        //     const synth = new Tone.Synth().toDestination();
        //     synth.triggerAttackRelease("C4", "8n"); // Play middle C for an eighth note
        // }


        function init() {
            let controls = document.getElementsByTagName('my-notes-fretboard');

            for(let i = 0; i < controls.length; ++i) {
                let c = controls[i];
                let parent = c.parentNode;
                let div = document.createElement('div');
                div.innerHTML = '<!-- control to add html to be implemented -->';
                parent.replaceChild(div, c);
            }

        }

        function onLoad() {
            init();
            clearNotes();
            loadNotes();
        }


        onLoad();

    </script>

</html>
